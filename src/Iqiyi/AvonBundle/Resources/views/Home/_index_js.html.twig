<script>
$(function(){
	/*qrcode-avon*/
	$("#qrcode-avon").qrcode({render: 'table', width: 115,height: 115,text: location.href});
	/*slide story*/
	var sliderStory = $('div.slider-story').unslider();
	$('a.slider-story-btn-prev').click(function() {
        sliderStory.data('unslider').prev();
    });
    $('a.slider-story-btn-next').click(function() {
        sliderStory.data('unslider').next();
    });
    /*slider week*/
    var sliderWeek = $('div.slider-week').unslider();
	$('a.slider-week-btn-prev').click(function() {
        sliderWeek.data('unslider').prev();
    });
    $('a.slider-week-btn-next').click(function() {
        sliderWeek.data('unslider').next();
    });
    /*avon share*/
    $("area.share-weibo").click(function(){
    	var title = "如果2014年，还有什么重要的时刻你还在期待，你必须不能错过这个视频，它能让你成就最美一瞬！";  
    	var url = encodeURIComponent(location.href); 
    	weibo(title, url);
    });
    $("area.share-renren").click(function(){
    	var title = "如果2014年，还有什么重要的时刻你还在期待，你必须不能错过这个视频，它能让你成就最美一瞬！";  
    	var url = encodeURIComponent(location.href); 
    	renren(title, url);
    });
    $("area.share-tx").click(function(){
    	var title = "如果2014年，还有什么重要的时刻你还在期待，你必须不能错过这个视频，它能让你成就最美一瞬！";  
    	var url = encodeURIComponent(location.href); 
    	tx(title, url);
    });
    /*share*/
	$('a.weibo-share').click(function(){
		event.preventDefault();
		var title = "如果2014年，还有什么重要的时刻你还在期待，你必须不能错过这个视频，它能让你成就最美一瞬！";  
		var url = encodeURIComponent($(this).attr("href")); 
		weibo(title, url);
	});
	$('a.renren-share').click(function(){
		event.preventDefault();
		var title = "如果2014年，还有什么重要的时刻你还在期待，你必须不能错过这个视频，它能让你成就最美一瞬！";  
		var url = encodeURIComponent($(this).attr("href")); 
		renren(title, url);
	});
	$('a.tx-share').click(function(){
		event.preventDefault();
		var title = "如果2014年，还有什么重要的时刻你还在期待，你必须不能错过这个视频，它能让你成就最美一瞬！";  
		var url = encodeURIComponent($(this).attr("href")); 
		tx(title, url);
	});
	/*words maxlength*/
	$("textarea.words-input").on("keyup", function(){
		var wordsContent = $(this).val();
		var maxLength = $(this).attr('maxlength');
		var left = maxLength - wordsContent.length;
		if(left < 0){
			left=0;
			$(this).val(wordsContent.substring(0, maxLength));
		}
		//$("span.words-left").text("还能填写"+left+"字");
	});
	/*words select*/
	$("span.words-select, span.arrow").click(function(){
		$("ul.words-select-list").toggle();
	});
	$("ul.words-select-list li.lazy_reason").each(function(){
		$(this).click(function(){
			if($(this).text()!=''){
				$("textarea.words-input").select().val($(this).text());
				//$("span.words-select").text($(this).text());
				$("ul.words-select-list").toggle();
			}
		});
	})
	/*words ok*/
	$("a.words-ok").click(function(){
		if($.trim($("textarea.words-input").val()) == '' || $.trim($("textarea.words-input").val()).length<5){
			$("textarea.words-input").focus();
			alert("请填写您的蝶舞瞬间, 最少5个字");
			return;
		}
		$.colorbox({inline:true, href:"#myForm"});
		$("textarea.words-form").val($("textarea.words-input").val());
	});
	/*ajax submit words*/
	$("#words-form").submit(function(event){
		event.preventDefault();
		$.ajax({
           type: "POST",
           url: $(this).attr('action'),
           data: $(this).serialize(),
           success: function(data)
           {
               	if(data.success == 1){
               		$("#words-form")[0].reset();
               		$("#words-form .words-form-token").val(data.token);
               		var sharedUrl = "{{ url('iqiyi_avon_subjects') }}?shared="+data.id;
               		$("#share-weibo").click(function(){
               			var title = "如果2014年，还有什么重要的时刻你还在期待，你必须不能错过这个视频，它能让你成就最美一瞬！";  
				    	var url = encodeURIComponent(sharedUrl); 
				    	weibo(title, url);
               		});
               		$("#share-renren").click(function(){
               			var title = "如果2014年，还有什么重要的时刻你还在期待，你必须不能错过这个视频，它能让你成就最美一瞬！";  
				    	var url = encodeURIComponent(sharedUrl); 
				    	renren(title, url);
               		});
               		$("#share-tx").click(function(){
               			var title = "如果2014年，还有什么重要的时刻你还在期待，你必须不能错过这个视频，它能让你成就最美一瞬！";  
				    	var url = encodeURIComponent(sharedUrl); 
				    	tx(title, url);
               		});
               		$("#qrcode-share").qrcode({render: 'table', width: 115,height: 115,text: sharedUrl});
               		$.colorbox({inline:true, href:"#shareForm"});
               	}else{
               		for(var i in data.errorList){
               			$("span.error-"+i).text(data.errorList[i]);
               		}
               	}
           }
         });
		return false;
	});	
	$("a.words-form-save").click(function(){
		$("#words-form").submit();
	});
	/*close light box*/
	$(".btn_close_lightbox").click(function(){
		$.colorbox.close();
	});
	/*show reward list*/
	$("a.btn_hjmd, a.btn_02").click(function(){
		$.colorbox({inline:true, href:"#hjmd"});
	});
	/*submit like*/
	$("a.words-like").each(function(){
		$(this).click(function(){
			var likeForm = $(this).parent().next().find("form.vote-form-like").eq(0);
			$(likeForm).submit();
		});
	});
	$("form.vote-form-like").submit(function(){
		event.preventDefault();
		$.ajax({
	       type: "POST",
	       url: $(this).attr('action'),
	       data: $(this).serialize(),
	       success: function(data)
	       {
	           	if(data.success == 1){
	            	$("span.vote-num-"+data.id).text(data.vote);
                $("input.vote-form-like-token").val(data.token);
	           	}else{
	           		for(var i in data.errorList){
	           			alert(data.errorList[i]);
	           		}
	           	}
	       }
	     });
		return false;
	});
	/*tmall code*/
	$("form.vote-form-redeem").submit(function(event){
	    event.preventDefault();
	    return false;
	  }); 
	$("a.words-like-tmall").each(function(){
		$(this).click(function(){
			var codeForm = $(this).parent().next().find("form.vote-form-redeem").eq(0).clone();
			//bind submit
			codeForm.submit(function(event){
		    event.preventDefault();
		    if('' == $.trim($(this).find("input:text").val())){
		      alert("请填写天猫码");
		    }else{
		      $.ajax({
		           type: "POST",
		           url: $(this).attr('action'),
		           data: $(this).serialize(),
		           success: function(data)
		           {
		                if(data.success == 1){
		                  $("span.vote-num-"+data.id).text(data.vote);
			                $("input.vote-form-like-token").val(data.token);
			                $.colorbox.close();
		                }else{
		                  for(var i in data.errorList){
		                    alert(data.errorList[i]);
		                  }
		                }
		           }
		         });
		    }
		    return false;
		  }); 
		  $("div.tc_tianmaoma_area").html(codeForm);
			$.colorbox({inline: true, href: "#tmallCode"});
		});
	});
	$("a.tmall-like-btn").click(function(){
		$("div.tc_tianmaoma_area form.vote-form-redeem").submit();
	});
});

function weibo(title, url){
	shareSocial('http://v.t.sina.com.cn/share/share.php?title={title}&url={url}', title, url);
}
function renren(title, url){
	shareSocial('http://widget.renren.com/dialog/share?resourceUrl={url}&title={title}', title, url);
}
function tx(title, url){
	shareSocial('http://share.v.t.qq.com/index.php?c=share&a=index&url={url}&title={title}', title, url);
}
function shareSocial(server_url,title, url)
{  
    server_url = server_url.replace("{title}",title);  
    server_url = server_url.replace("{url}",url);  
    window.open(server_url ,'_blank','scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes');
}  
</script>